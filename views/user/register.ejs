<!DOCTYPE html>
<html>
    <head>
        <title>RSPP íšŒì›</title>
        <%- include(viewDir('./_head')) %>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/sha256.js"></script>
        <script type="text/javascript">
            function mysql_real_escape_string(str) {
                if (typeof str != "string") return str;

                return str.replace(/[\0\x08\x09\x1a\n\r"'\\\%]/g, function (char) {
                    switch (char) {
                        case "\0":
                            return "\\0";
                        case "\x08":
                            return "\\b";
                        case "\x09":
                            return "\\t";
                        case "\x1a":
                            return "\\z";
                        case "\n":
                            return "\\n";
                        case "\r":
                            return "\\r";
                        case '"':
                        case "'":
                        case "\\":
                        case "%":
                            return "\\" + char; // prepends a backslash to backslash, percent,
                        // and double/single quotes
                    }
                });
            }

            $(document).ready(function() {
                let k = new URL(document.URL).searchParams.get("url");
                if(k) $("#registerForm").attr("action", "/user/register?url=" + mysql_real_escape_string(k));

                $("#submitBtn").click(function() {
                    $("#password3").val(CryptoJS.SHA256($("#password3").val()).toString());

                    $("#registerForm").submit();
                });
            });
        </script>
    </head>
    <body>
        <div class="wrapper">
            <%- include(viewDir('./_navbar')) %>
            <div id="content" class="container-fluid">
                <header><h2 id="pageTitle">RSPP íšŒì› ë“±ë¡</h2></header>
                <article>
                    <div class="container-md">
                        <section>
                            <div id="form">
                                <form name="registerForm" id="registerForm" action="/user/register" method="post">
                                    <input type="hidden" name="_csrf", value="<%= _csrf %>" />
                                    <div class="input-group mb-3">
                                        <span class="input-group-text" id="name0">ğŸ˜Š</span>
                                        <input type="text" name="name" class="form-control" placeholder="íšŒì›ëª…" aria-label="íšŒì›ëª…" aria-describedby="name0" />
                                    </div>
                                    <div class="input-group mb-3">
                                        <span class="input-group-text" id="username1">ğŸ’¾</span>
                                        <input type="text" name="username" class="form-control" placeholder="ì•„ì´ë””" aria-label="ì•„ì´ë””" aria-describedby="username1" />
                                    </div>
                                    <div class="input-group mb-3">
                                        <span class="input-group-text" id="password1">ğŸ”</span>
                                        <input type="password" id="password3" name="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸" aria-label="ë¹„ë°€ë²ˆí˜¸" aria-describedby="password1" />
                                    </div>
                                    <div class="input-group mb-3">
                                        <span class="input-group-text" id="password2">ğŸ”</span>
                                        <input type="password" id="password3" name="password3" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" aria-label="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" aria-describedby="password2" />
                                    </div>
                                    <div>
                                        <p style="font-size: calc(40%);">ë¹„ë°€ë²ˆí˜¸ì— ë„ì–´ì“°ê¸°( ) í¬í•¨ ì‹œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì¸ì •ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>
                                    </div>
                                    <div class="input-group mb-3">
                                        <span class="input-group-text" id="code0">ğŸ’</span>
                                        <input type="number" name="code" class="form-control" placeholder="ì½”ë“œ" aria-label="ì½”ë“œ" aria-describedby="code0" />
                                    </div>
                                    <input class="btn btn-primary" id="submitBtn" type="submit" value="íšŒì› ë“±ë¡ ìš”ì²­" />
                                </form>
                            </div>
                        </section>
                    </div>
                    <div>&nbsp;</div>
                </article>
                <%- include(viewDir("./aside/index")) %>
            </div>
        </div>
        <%- include(viewDir('./.footer')) %>
    </body>
    <%- include(viewDir('./_bottom')) %>
</html>
